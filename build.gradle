import org.apache.tools.ant.filters.*

project.description = "Solr Builder on to Tomcat7"

tomcatHome = app_tomcat_dir + env_path_sep + "tomcat7_" + instanceNumber
catalinaHome = app_tomcat_dir + env_path_sep + "tomcat7_" + instanceNumber + env_path_sep + "apache-tomcat-7.0.34"
solrHome = app_solr_home_dir + env_path_sep + "solr_home_" + instanceNumber
tomcatwebapp = catalinaHome + env_path_sep + 'webapps'

task unzipTomcat(type: Copy) {
	println "Installing tomcat 7 ..."
	def zipFile = file(install_tomcat7zip)
	def outputDir = file(tomcatHome)
	from zipTree(zipFile)
	into outputDir
}

task copySolrWar(type: Copy, dependsOn: unzipTomcat) {
	println "copy solr war to tomcat ..."
	def sourceFile = file(install_solr4war)
	def targetDir = file(tomcatwebapp)
	from sourceFile
	into targetDir
	rename ('apache-solr-4.0.0.war', 'solr.war')
}

task copySolrContextXml(type: Copy, dependsOn: copySolrWar) {
	println "configuring tomcat 7 ..."
	def sourceDir = file(install_solrConfig)
	def targetDir = file(catalinaHome + '/conf/Catalina/localhost')
	from sourceDir
	into targetDir
	
	// rename the tomcat_solr_war
	// rename the solr_home_location
	filter(ReplaceTokens, tokens: [tomcat_solr_war: tomcatwebapp + env_path_sep + "solr.war", solr_home_location: solrHome])
}

task copySolrHome(type: Copy, dependsOn: copySolrContextXml) {
	println "Installing solr home ..."
	def sourceDir = file(install_solrHome)
	def targetDir = file(solrHome)
	from sourceDir
	into targetDir
}

task install(dependsOn: copySolrHome) {
	
	
	println "Done"
}

task clean(type: Delete) {
   delete tomcatHome, solrHome
}

task wrapper(type: Wrapper) {
    gradleVersion = '1.3'
}

 


